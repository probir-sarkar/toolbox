{"version":3,"sources":["../src/index.ts"],"sourcesContent":["import JSZip from \"jszip\";\n\nlet pdfjsLib: any = null;\n\nconst getPdfjs = async () => {\n  if (!pdfjsLib) {\n    // @ts-ignore\n    pdfjsLib = await import(\"pdfjs-dist/build/pdf\");\n  }\n  return pdfjsLib;\n};\n\n/**\n * Initialize PDF.js worker with custom worker source.\n * This should be called before using any PDF functions.\n */\nexport async function initPdfWorker() {\n  const lib = await getPdfjs();\n  lib.GlobalWorkerOptions.workerSrc = \"https://cdn.jsdelivr.net/npm/pdfjs-dist@5.4.54/build/pdf.worker.min.mjs\";\n}\n\nfunction getBaseName(file: File): string {\n  const name = file.name.replace(/\\.[^/.]+$/, \"\"); // remove extension\n  return name || \"document\";\n}\n\nexport interface PdfToImageOptions {\n  format?: \"image/png\" | \"image/jpeg\";\n  scale?: number; // DPI-like scaling (higher = sharper images)\n  startPage?: number; // default = 1\n  endPage?: number | null; // default = total pages\n  quality?: number; // only for JPEG (0.1 - 1.0)\n}\n\nexport type ImageResult = {\n  page: number;\n  blob: Blob;\n  filename: string;\n  baseName: string;\n  width: number;\n  height: number;\n  url: string;\n};\n\nexport async function pdfToImagesBrowser(file: File, options: PdfToImageOptions = {}): Promise<ImageResult[]> {\n  const {\n    format = \"image/png\",\n    scale = 2,\n    startPage = 1,\n    endPage,\n    quality = 0.92 // default JPEG quality\n  } = options;\n  const baseName = getBaseName(file);\n\n  const fileData = await file.arrayBuffer();\n  const lib = await getPdfjs();\n  const pdf = await lib.getDocument({ data: fileData }).promise;\n\n  const results: ImageResult[] = [];\n\n  const lastPage = endPage && endPage <= pdf.numPages ? endPage : pdf.numPages;\n\n  for (let pageNum = startPage; pageNum <= lastPage; pageNum++) {\n    const page = await pdf.getPage(pageNum);\n    const viewport = page.getViewport({ scale });\n\n    const canvas = document.createElement(\"canvas\");\n    const context = canvas.getContext(\"2d\")!;\n    canvas.width = viewport.width;\n    canvas.height = viewport.height;\n\n    await page.render({ canvasContext: context, viewport }).promise;\n\n    // PNG ignores quality param, JPEG uses it\n    const blob: Blob = await new Promise((resolve) =>\n      canvas.toBlob((b) => resolve(b!), format, format === \"image/jpeg\" ? quality : undefined)\n    );\n\n    // Create an object URL for preview/download\n    const url = URL.createObjectURL(blob);\n\n    // Push full ImageResult\n    results.push({\n      page: pageNum,\n      blob,\n      filename: `${baseName}-page-${pageNum}.${format === \"image/png\" ? \"png\" : \"jpg\"}`,\n      baseName,\n      width: canvas.width,\n      height: canvas.height,\n      url\n    });\n  }\n\n  return results;\n}\n\nexport function triggerDownload(blob: Blob, filename: string) {\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement(\"a\");\n  a.href = url;\n  a.download = filename || \"download\";\n  document.body.appendChild(a);\n  a.click();\n  a.remove();\n  setTimeout(() => URL.revokeObjectURL(url), 500);\n}\n\nexport async function downloadAll(images: ImageResult[]) {\n  if (!images.length) return;\n\n  const baseName = images[0].baseName || \"document\";\n\n  if (images.length === 1) {\n    triggerDownload(images[0].blob, images[0].filename);\n  } else {\n    const zip = new JSZip();\n    const folder = zip.folder(baseName) as JSZip;\n    images.forEach((img) => folder.file(img.filename, img.blob));\n    const blob = await zip.generateAsync({ type: \"blob\" });\n    triggerDownload(blob, `${baseName}-images.zip`);\n  }\n}\n\nexport interface FileInfo {\n  name: string;\n  size: string;\n  pages: number;\n  file: File;\n}\n\nexport async function getFileInfo(file: File): Promise<FileInfo> {\n  const name = file.name;\n  const size = `${(file.size / 1024 / 1024).toFixed(2)} MB`;\n\n  let pages = 0;\n\n  if (file.type === \"application/pdf\") {\n    const arrayBuffer = await file.arrayBuffer();\n    const lib = await getPdfjs();\n    const pdf = await lib.getDocument({ data: arrayBuffer }).promise;\n    pages = pdf.numPages;\n  }\n\n  return {\n    name,\n    size,\n    pages,\n    file\n  };\n}\n"],"mappings":";AAAA,OAAO,WAAW;AAElB,IAAI,WAAgB;AAEpB,IAAM,WAAW,YAAY;AAC3B,MAAI,CAAC,UAAU;AAEb,eAAW,MAAM,OAAO,sBAAsB;AAAA,EAChD;AACA,SAAO;AACT;AAMA,eAAsB,gBAAgB;AACpC,QAAM,MAAM,MAAM,SAAS;AAC3B,MAAI,oBAAoB,YAAY;AACtC;AAEA,SAAS,YAAY,MAAoB;AACvC,QAAM,OAAO,KAAK,KAAK,QAAQ,aAAa,EAAE;AAC9C,SAAO,QAAQ;AACjB;AAoBA,eAAsB,mBAAmB,MAAY,UAA6B,CAAC,GAA2B;AAC5G,QAAM;AAAA,IACJ,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,YAAY;AAAA,IACZ;AAAA,IACA,UAAU;AAAA;AAAA,EACZ,IAAI;AACJ,QAAM,WAAW,YAAY,IAAI;AAEjC,QAAM,WAAW,MAAM,KAAK,YAAY;AACxC,QAAM,MAAM,MAAM,SAAS;AAC3B,QAAM,MAAM,MAAM,IAAI,YAAY,EAAE,MAAM,SAAS,CAAC,EAAE;AAEtD,QAAM,UAAyB,CAAC;AAEhC,QAAM,WAAW,WAAW,WAAW,IAAI,WAAW,UAAU,IAAI;AAEpE,WAAS,UAAU,WAAW,WAAW,UAAU,WAAW;AAC5D,UAAM,OAAO,MAAM,IAAI,QAAQ,OAAO;AACtC,UAAM,WAAW,KAAK,YAAY,EAAE,MAAM,CAAC;AAE3C,UAAM,SAAS,SAAS,cAAc,QAAQ;AAC9C,UAAM,UAAU,OAAO,WAAW,IAAI;AACtC,WAAO,QAAQ,SAAS;AACxB,WAAO,SAAS,SAAS;AAEzB,UAAM,KAAK,OAAO,EAAE,eAAe,SAAS,SAAS,CAAC,EAAE;AAGxD,UAAM,OAAa,MAAM,IAAI;AAAA,MAAQ,CAAC,YACpC,OAAO,OAAO,CAAC,MAAM,QAAQ,CAAE,GAAG,QAAQ,WAAW,eAAe,UAAU,MAAS;AAAA,IACzF;AAGA,UAAM,MAAM,IAAI,gBAAgB,IAAI;AAGpC,YAAQ,KAAK;AAAA,MACX,MAAM;AAAA,MACN;AAAA,MACA,UAAU,GAAG,QAAQ,SAAS,OAAO,IAAI,WAAW,cAAc,QAAQ,KAAK;AAAA,MAC/E;AAAA,MACA,OAAO,OAAO;AAAA,MACd,QAAQ,OAAO;AAAA,MACf;AAAA,IACF,CAAC;AAAA,EACH;AAEA,SAAO;AACT;AAEO,SAAS,gBAAgB,MAAY,UAAkB;AAC5D,QAAM,MAAM,IAAI,gBAAgB,IAAI;AACpC,QAAM,IAAI,SAAS,cAAc,GAAG;AACpC,IAAE,OAAO;AACT,IAAE,WAAW,YAAY;AACzB,WAAS,KAAK,YAAY,CAAC;AAC3B,IAAE,MAAM;AACR,IAAE,OAAO;AACT,aAAW,MAAM,IAAI,gBAAgB,GAAG,GAAG,GAAG;AAChD;AAEA,eAAsB,YAAY,QAAuB;AACvD,MAAI,CAAC,OAAO,OAAQ;AAEpB,QAAM,WAAW,OAAO,CAAC,EAAE,YAAY;AAEvC,MAAI,OAAO,WAAW,GAAG;AACvB,oBAAgB,OAAO,CAAC,EAAE,MAAM,OAAO,CAAC,EAAE,QAAQ;AAAA,EACpD,OAAO;AACL,UAAM,MAAM,IAAI,MAAM;AACtB,UAAM,SAAS,IAAI,OAAO,QAAQ;AAClC,WAAO,QAAQ,CAAC,QAAQ,OAAO,KAAK,IAAI,UAAU,IAAI,IAAI,CAAC;AAC3D,UAAM,OAAO,MAAM,IAAI,cAAc,EAAE,MAAM,OAAO,CAAC;AACrD,oBAAgB,MAAM,GAAG,QAAQ,aAAa;AAAA,EAChD;AACF;AASA,eAAsB,YAAY,MAA+B;AAC/D,QAAM,OAAO,KAAK;AAClB,QAAM,OAAO,IAAI,KAAK,OAAO,OAAO,MAAM,QAAQ,CAAC,CAAC;AAEpD,MAAI,QAAQ;AAEZ,MAAI,KAAK,SAAS,mBAAmB;AACnC,UAAM,cAAc,MAAM,KAAK,YAAY;AAC3C,UAAM,MAAM,MAAM,SAAS;AAC3B,UAAM,MAAM,MAAM,IAAI,YAAY,EAAE,MAAM,YAAY,CAAC,EAAE;AACzD,YAAQ,IAAI;AAAA,EACd;AAEA,SAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACF;AACF;","names":[]}