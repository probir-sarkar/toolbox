{"version":3,"sources":["../src/image-converter.ts"],"sourcesContent":["export type ImageFormat = \"jpeg\" | \"png\" | \"webp\";\r\n\r\nexport interface ConvertOptions {\r\n  quality?: number; // 0â€“1 (jpeg/webp)\r\n}\r\n\r\nexport class ImageConverter {\r\n  private bitmap: ImageBitmap | null;\r\n\r\n  private constructor(bitmap: ImageBitmap) {\r\n    this.bitmap = bitmap;\r\n  }\r\n\r\n  static async fromBlob(blob: Blob): Promise<ImageConverter> {\r\n    const bitmap = await createImageBitmap(blob);\r\n    return new ImageConverter(bitmap);\r\n  }\r\n\r\n  async convert(format: ImageFormat, options?: ConvertOptions): Promise<Uint8Array> {\r\n    if (!this.bitmap) {\r\n      throw new Error(\"ImageConverter already destroyed\");\r\n    }\r\n\r\n    const canvas = document.createElement(\"canvas\");\r\n    canvas.width = this.bitmap.width;\r\n    canvas.height = this.bitmap.height;\r\n\r\n    const ctx = canvas.getContext(\"2d\");\r\n    if (!ctx) throw new Error(\"Canvas not supported\");\r\n\r\n    ctx.drawImage(this.bitmap, 0, 0);\r\n\r\n    const mime = format === \"jpeg\" ? \"image/jpeg\" : format === \"webp\" ? \"image/webp\" : \"image/png\";\r\n\r\n    const blob = await new Promise<Blob>((resolve) => canvas.toBlob((b) => resolve(b!), mime, options?.quality));\r\n\r\n    return new Uint8Array(await blob.arrayBuffer());\r\n  }\r\n\r\n  destroy(): void {\r\n    this.bitmap?.close();\r\n    this.bitmap = null;\r\n  }\r\n}\r\n"],"mappings":";AAMO,IAAM,iBAAN,MAAM,gBAAe;AAAA,EAGlB,YAAY,QAAqB;AACvC,SAAK,SAAS;AAAA,EAChB;AAAA,EAEA,aAAa,SAAS,MAAqC;AACzD,UAAM,SAAS,MAAM,kBAAkB,IAAI;AAC3C,WAAO,IAAI,gBAAe,MAAM;AAAA,EAClC;AAAA,EAEA,MAAM,QAAQ,QAAqB,SAA+C;AAChF,QAAI,CAAC,KAAK,QAAQ;AAChB,YAAM,IAAI,MAAM,kCAAkC;AAAA,IACpD;AAEA,UAAM,SAAS,SAAS,cAAc,QAAQ;AAC9C,WAAO,QAAQ,KAAK,OAAO;AAC3B,WAAO,SAAS,KAAK,OAAO;AAE5B,UAAM,MAAM,OAAO,WAAW,IAAI;AAClC,QAAI,CAAC,IAAK,OAAM,IAAI,MAAM,sBAAsB;AAEhD,QAAI,UAAU,KAAK,QAAQ,GAAG,CAAC;AAE/B,UAAM,OAAO,WAAW,SAAS,eAAe,WAAW,SAAS,eAAe;AAEnF,UAAM,OAAO,MAAM,IAAI,QAAc,CAAC,YAAY,OAAO,OAAO,CAAC,MAAM,QAAQ,CAAE,GAAG,MAAM,SAAS,OAAO,CAAC;AAE3G,WAAO,IAAI,WAAW,MAAM,KAAK,YAAY,CAAC;AAAA,EAChD;AAAA,EAEA,UAAgB;AACd,SAAK,QAAQ,MAAM;AACnB,SAAK,SAAS;AAAA,EAChB;AACF;","names":[]}