{"version":3,"sources":["../src/photon-runtime.ts","../src/photon-image-converter.ts"],"sourcesContent":["type PhotonRuntime = typeof import(\"@silvia-odwyer/photon\");\r\n\r\ndeclare global {\r\n  interface Window {\r\n    __PHOTON_RUNTIME__?: Promise<PhotonRuntime>;\r\n  }\r\n}\r\n\r\nexport function getPhotonRuntime(): Promise<PhotonRuntime> {\r\n  if (typeof window === \"undefined\") {\r\n    throw new Error(\"Photon can only run in the browser\");\r\n  }\r\n\r\n  if (!window.__PHOTON_RUNTIME__) {\r\n    window.__PHOTON_RUNTIME__ = (async () => {\r\n      const photon = await import(\"@silvia-odwyer/photon\");\r\n      await photon.default(); // WASM init\r\n      return photon;\r\n    })();\r\n  }\r\n\r\n  return window.__PHOTON_RUNTIME__;\r\n}\r\n","import type { PhotonImage } from \"@silvia-odwyer/photon\";\r\nimport { getPhotonRuntime } from \"./photon-runtime\";\r\n\r\nexport type ImageFormat = \"jpeg\" | \"png\" | \"webp\";\r\n\r\nexport interface ConvertOptions {\r\n  quality?: number; // 1â€“100 (JPEG only)\r\n}\r\n\r\nexport class PhotonImageConverter {\r\n  private readonly image: PhotonImage;\r\n  private destroyed = false;\r\n\r\n  private constructor(image: PhotonImage) {\r\n    this.image = image;\r\n  }\r\n\r\n  /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ FACTORY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\r\n\r\n  static async fromBlob(blob: Blob): Promise<PhotonImageConverter> {\r\n    if (!blob || blob.size === 0) {\r\n      throw new Error(\"Invalid or empty blob\");\r\n    }\r\n\r\n    const photon = await getPhotonRuntime();\r\n\r\n    // ðŸ”‘ Clone blob to avoid WASM panic\r\n    const safeBlob = blob.slice(0, blob.size, blob.type);\r\n\r\n    return new PhotonImageConverter(photon.PhotonImage.new_from_blob(safeBlob));\r\n  }\r\n\r\n  /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ CONVERT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\r\n\r\n  convertToFormat(format: ImageFormat, options?: ConvertOptions): Uint8Array {\r\n    if (this.destroyed) {\r\n      throw new Error(\"Converter already destroyed\");\r\n    }\r\n\r\n    switch (format) {\r\n      case \"jpeg\": {\r\n        const quality = options?.quality ?? 100;\r\n\r\n        return this.image.get_bytes_jpeg(50);\r\n      }\r\n\r\n      case \"png\":\r\n        return this.image.get_bytes();\r\n\r\n      case \"webp\":\r\n        return this.image.get_bytes_webp();\r\n\r\n      default: {\r\n        // Exhaustive safety (future-proof)\r\n        const _exhaustive: never = format;\r\n        return _exhaustive;\r\n      }\r\n    }\r\n  }\r\n\r\n  /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ CLEANUP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */\r\n\r\n  destroy(): void {\r\n    if (this.destroyed) return;\r\n    this.image.free();\r\n    this.destroyed = true;\r\n  }\r\n}\r\n"],"mappings":";AAQO,SAAS,mBAA2C;AACzD,MAAI,OAAO,WAAW,aAAa;AACjC,UAAM,IAAI,MAAM,oCAAoC;AAAA,EACtD;AAEA,MAAI,CAAC,OAAO,oBAAoB;AAC9B,WAAO,sBAAsB,YAAY;AACvC,YAAM,SAAS,MAAM,OAAO,uBAAuB;AACnD,YAAM,OAAO,QAAQ;AACrB,aAAO;AAAA,IACT,GAAG;AAAA,EACL;AAEA,SAAO,OAAO;AAChB;;;ACbO,IAAM,uBAAN,MAAM,sBAAqB;AAAA,EAIxB,YAAY,OAAoB;AAFxC,SAAQ,YAAY;AAGlB,SAAK,QAAQ;AAAA,EACf;AAAA;AAAA,EAIA,aAAa,SAAS,MAA2C;AAC/D,QAAI,CAAC,QAAQ,KAAK,SAAS,GAAG;AAC5B,YAAM,IAAI,MAAM,uBAAuB;AAAA,IACzC;AAEA,UAAM,SAAS,MAAM,iBAAiB;AAGtC,UAAM,WAAW,KAAK,MAAM,GAAG,KAAK,MAAM,KAAK,IAAI;AAEnD,WAAO,IAAI,sBAAqB,OAAO,YAAY,cAAc,QAAQ,CAAC;AAAA,EAC5E;AAAA;AAAA,EAIA,gBAAgB,QAAqB,SAAsC;AACzE,QAAI,KAAK,WAAW;AAClB,YAAM,IAAI,MAAM,6BAA6B;AAAA,IAC/C;AAEA,YAAQ,QAAQ;AAAA,MACd,KAAK,QAAQ;AACX,cAAM,UAAU,SAAS,WAAW;AAEpC,eAAO,KAAK,MAAM,eAAe,EAAE;AAAA,MACrC;AAAA,MAEA,KAAK;AACH,eAAO,KAAK,MAAM,UAAU;AAAA,MAE9B,KAAK;AACH,eAAO,KAAK,MAAM,eAAe;AAAA,MAEnC,SAAS;AAEP,cAAM,cAAqB;AAC3B,eAAO;AAAA,MACT;AAAA,IACF;AAAA,EACF;AAAA;AAAA,EAIA,UAAgB;AACd,QAAI,KAAK,UAAW;AACpB,SAAK,MAAM,KAAK;AAChB,SAAK,YAAY;AAAA,EACnB;AACF;","names":[]}